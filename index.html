<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puzzles: Nonogram, Norinori, Sudoku</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #f4f4f4;
    }
    h1, h2 {
      color: #333;
      text-align: center;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .puzzle {
      margin: 30px 0;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
    }
    td, th {
      width: 30px;
      height: 30px;
      text-align: center;
      border: 1px solid #ccc;
    }
    .clue {
      background-color: #eee;
      font-size: 12px;
    }
    .cell {
      cursor: pointer;
    }
    .filled {
      background-color: black;
    }
    .crossed {
      background-color: #ccc;
    }
    .norinori .cell {
      background-color: #f9f9f9;
    }
    .norinori .filled {
      background-color: #333;
    }
    .sudoku input {
      width: 40px;
      height: 40px;
      text-align: center;
      font-size: 20px;
      margin: 1px;
      border: 1px solid #ccc;
    }
    .sudoku input.fixed {
      font-weight: bold;
      background-color: #e0e0e0;
    }
    .clues-horizontal, .clues-vertical {
      display: flex;
      justify-content: center;
    }
    .clue-row {
      display: flex;
    }
    .clue-cell {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Puzzles Interactivos</h1>

    <!-- Nonogram 5x5 -->
    <div class="puzzle">
      <h2>Nonograma 5x5</h2>
      <button onclick="generateNonogram(5)">Generar Nonograma 5x5</button>
      <div id="nonogram5"></div>
    </div>

    <!-- Nonogram 10x10 -->
    <div class="puzzle">
      <h2>Nonograma 10x10</h2>
      <button onclick="generateNonogram(10)">Generar Nonograma 10x10</button>
      <div id="nonogram10"></div>
    </div>

    <!-- Norinori 20x20 -->
    <div class="puzzle">
      <h2>Norinori 20x20</h2>
      <button onclick="generateNorinori()">Generar Norinori 20x20</button>
      <div id="norinori"></div>
    </div>

    <!-- Sudoku -->
    <div class="puzzle">
      <h2>Sudoku (Nivel Normal)</h2>
      <button onclick="generateSudoku()">Generar Sudoku</button>
      <div id="sudoku"></div>
    </div>
  </div>

  <script>
    // --------------------------
    // NONOGRAM GENERATOR
    // --------------------------
    function generateNonogram(size) {
      const id = size === 5 ? "nonogram5" : "nonogram10";
      const container = document.getElementById(id);
      container.innerHTML = "";

      // Crear solución aleatoria
      const grid = Array(size).fill().map(() => Array(size).fill(0));
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          grid[i][j] = Math.random() < 0.4 ? 1 : 0;
        }
      }

      // Calcular pistas
      const rowClues = grid.map(row => {
        const clues = [];
        let count = 0;
        for (let cell of row) {
          if (cell === 1) count++;
          else if (count > 0) {
            clues.push(count);
            count = 0;
          }
        }
        if (count > 0) clues.push(count);
        return clues.length ? clues : [0];
      });

      const colClues = [];
      for (let j = 0; j < size; j++) {
        const clues = [];
        let count = 0;
        for (let i = 0; i < size; i++) {
          if (grid[i][j] === 1) count++;
          else if (count > 0) {
            clues.push(count);
            count = 0;
          }
        }
        if (count > 0) clues.push(count);
        colClues.push(clues.length ? clues : [0]);
      }

      // Máximo de pistas por fila/columna
      const maxRowClues = Math.max(...rowClues.map(r => r.length));
      const maxColClues = Math.max(...colClues.map(c => c.length));

      // Tabla
      const table = document.createElement("table");
      const header = document.createElement("tr");

      // Espacio vacío para esquina
      const corner = document.createElement("th");
      corner.innerHTML = "";
      header.appendChild(corner);

      // Pistas de columnas
      for (let j = 0; j < size; j++) {
        const th = document.createElement("th");
        th.colSpan = 1;
        const clueDiv = document.createElement("div");
        clueDiv.className = "clue-cell";
        clueDiv.textContent = colClues[j].join(" ");
        th.appendChild(clueDiv);
        header.appendChild(th);
      }
      table.appendChild(header);

      // Filas con pistas y celdas
      for (let i = 0; i < size; i++) {
        const tr = document.createElement("tr");

        // Pista de fila
        const clueTd = document.createElement("td");
        clueTd.className = "clue";
        clueTd.textContent = rowClues[i].join(" ");
        tr.appendChild(clueTd);

        // Celdas del grid
        for (let j = 0; j < size; j++) {
          const td = document.createElement("td");
          td.className = "cell";
          td.dataset.row = i;
          td.dataset.col = j;
          td.onclick = function() {
            if (this.classList.contains("filled")) {
              this.classList.remove("filled");
              this.classList.add("crossed");
            } else if (this.classList.contains("crossed")) {
              this.classList.remove("crossed");
            } else {
              this.classList.add("filled");
            }
          };
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }

      container.appendChild(table);
    }

    // --------------------------
    // NORINORI GENERATOR (20x20)
    // --------------------------
    function generateNorinori() {
      const container = document.getElementById("norinori");
      container.innerHTML = "";

      const size = 20;
      const grid = Array(size).fill().map(() => Array(size).fill(0));

      // Llenar con dominós (pares de celdas conectadas)
      const used = Array(size).fill().map(() => Array(size).fill(false));
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (used[i][j]) continue;
          // Intentar colocar dominó horizontal o vertical
          const orientations = [];
          if (j + 1 < size && !used[i][j+1]) orientations.push("h");
          if (i + 1 < size && !used[i+1][j]) orientations.push("v");
          if (orientations.length === 0) continue;

          const dir = orientations[Math.floor(Math.random() * orientations.length)];
          if (dir === "h") {
            used[i][j] = true;
            used[i][j+1] = true;
            grid[i][j] = 1;
            grid[i][j+1] = 1;
          } else {
            used[i][j] = true;
            used[i+1][j] = true;
            grid[i][j] = 1;
            grid[i+1][j] = 1;
          }
        }
      }

      // Crear tabla
      const table = document.createElement("table");
      table.className = "norinori";

      for (let i = 0; i < size; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j < size; j++) {
          const td = document.createElement("td");
          td.className = "cell";
          td.dataset.row = i;
          td.dataset.col = j;
          td.onclick = function() {
            this.classList.toggle("filled");
          };
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }

      container.appendChild(table);
    }

    // --------------------------
    // SUDOKU GENERATOR
    // --------------------------
    function generateSudoku() {
      const container = document.getElementById("sudoku");
      container.innerHTML = "";

      // Solución completa
      let board = Array(9).fill().map(() => Array(9).fill(0));
      
      function isValid(row, col, num) {
        for (let i = 0; i < 9; i++) {
          if (board[row][i] === num || board[i][col] === num) return false;
        }
        const br = Math.floor(row / 3) * 3;
        const bc = Math.floor(col / 3) * 3;
        for (let i = 0; i < 3; i++) {
          for (let j = 0; j < 3; j++) {
            if (board[br + i][bc + j] === num) return false;
          }
        }
        return true;
      }

      function solve(row = 0, col = 0) {
        if (row === 9) return true;
        if (col === 9) return solve(row + 1, 0);
        if (board[row][col] !== 0) return solve(row, col + 1);

        const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
        for (let num of nums) {
          if (isValid(row, col, num)) {
            board[row][col] = num;
            if (solve(row, col + 1)) return true;
            board[row][col] = 0;
          }
        }
        return false;
      }

      solve();

      // Vaciar celdas (nivel normal: ~45 vacíos)
      const puzzle = board.map(row => [...row]);
      let cells = [];
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          cells.push([i, j]);
        }
      }
      cells.sort(() => Math.random() - 0.5);
      const toRemove = 45; // normal difficulty
      for (let k = 0; k < toRemove; k++) {
        const [i, j] = cells[k];
        puzzle[i][j] = 0;
      }

      // Crear interfaz
      const table = document.createElement("table");
      table.className = "sudoku";
      for (let i = 0; i < 9; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j < 9; j++) {
          const td = document.createElement("td");
          const input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          input.dataset.row = i;
          input.dataset.col = j;
          if (puzzle[i][j] !== 0) {
            input.value = puzzle[i][j];
            input.classList.add("fixed");
            input.readOnly = true;
          } else {
            input.addEventListener("input", function() {
              this.value = this.value.replace(/[^1-9]/g, '');
            });
          }
          td.appendChild(input);
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
      container.appendChild(table);
    }

    // Generar un nonograma 5x5 al cargar
    window.onload = () => generateNonogram(5);
  </script>
</body>
</html>
