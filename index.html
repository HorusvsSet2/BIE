<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puzzles: Nonogram, Norinori, Sudoku</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      margin: 20px;
      background-color: #f0f2f5;
      color: #2c3e50;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      font-weight: 700;
      font-size: 2.2em;
      margin-bottom: 10px;
    }
    h2 {
      color: #34495e;
      font-weight: 500;
      margin-top: 40px;
      font-size: 1.5em;
    }
    .puzzle {
      margin: 40px 0;
      text-align: center;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      margin: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    button:hover {
      background-color: #2980b9;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    button.success {
      background-color: #27ae60;
    }
    .message {
      font-weight: 600;
      font-size: 1.1em;
      margin: 15px 0;
      min-height: 28px;
      color: #27ae60;
      text-shadow: 0 1px 0 #fff;
    }
    table {
      margin: 20px auto;
      border-collapse: collapse;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      border: 2px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      box-sizing: border-box;
      width: 32px;
      height: 32px;
      text-align: center;
    }
    th {
      background-color: #f8f9fa;
      color: #555;
      font-weight: 500;
      font-size: 14px;
      padding: 5px;
      border-right: 1px solid #ddd;
      border-bottom: 1px solid #ddd;
    }
    th:last-child {
      border-right: none;
    }
    td {
      border: 1px solid #ccc;
      background-color: #fdfdfd;
      transition: background 0.15s ease, transform 0.05s ease;
    }
    td:hover {
      background-color: #f0f0f0;
    }
    /* Nonogram clue cells */
    .clue {
      background-color: #e9ecef !important;
      color: #495057;
      font-weight: 500;
      font-size: 13px;
      padding: 0 !important;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    /* Nonogram cells */
    .cell {
      cursor: pointer;
      user-select: none;
    }
    .filled {
      background-color: #000;
      box-shadow: inset 0 0 4px rgba(0,0,0,0.6);
    }
    .crossed {
      background-color: #aaa;
    }

    /* Norinori */
    .norinori .cell {
      background-color: #fcfcfc;
    }
    .norinori .filled {
      background-color: #2c3e50;
    }

    /* Sudoku */
    .sudoku input {
      width: 100%;
      height: 100%;
      text-align: center;
      font-size: 18px;
      font-weight: 500;
      border: 1px solid #ddd;
      padding: 0;
      outline: none;
      background-color: #fdfdfd;
      transition: background 0.2s;
    }
    .sudoku input:hover {
      background-color: #f8f9fa;
    }
    .sudoku input.fixed {
      font-weight: bold;
      background-color: #e9ecef;
      color: #2c3e50;
    }
    .sudoku input.error {
      background-color: #fdeded;
      border-color: #e74c3c;
    }

    /* Sudoku: bordes gruesos para bloques 3x3 */
    .sudoku tr:nth-child(3n) td {
      border-bottom: 2px solid #2c3e50;
    }
    .sudoku td:nth-child(3n) {
      border-right: 2px solid #2c3e50;
    }
    .sudoku tr:last-child td {
      border-bottom: 1px solid #ccc;
    }
    .sudoku td:last-child {
      border-right: 1px solid #ccc;
    }

    /* Responsive ajustes */
    @media (max-width: 700px) {
      .container { padding: 15px; }
      h1 { font-size: 1.8em; }
      h2 { font-size: 1.3em; }
      table { margin: 15px auto; }
      th, td { width: 26px; height: 26px; font-size: 12px; }
      .sudoku input { font-size: 16px; }
      button { padding: 10px 18px; font-size: 15px; }
    }

    /* Animaciones sutiles */
    .cell {
      transition: background 0.15s ease;
    }
    .cell.filled, .cell.crossed {
      transform: scale(0.95);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🧩 Puzzles Interactivos</h1>

    <!-- Nonogram 5x5 -->
    <div class="puzzle">
      <h2>Nonograma 5×5</h2>
      <button onclick="generateNonogram(5)">🔄 Generar Nuevo</button>
      <div class="message" id="msg-nonogram5"></div>
      <div id="nonogram5"></div>
    </div>

    <!-- Nonogram 10x10 -->
    <div class="puzzle">
      <h2>Nonograma 10×10</h2>
      <button onclick="generateNonogram(10)">🔄 Generar Nuevo</button>
      <div class="message" id="msg-nonogram10"></div>
      <div id="nonogram10"></div>
    </div>

    <!-- Norinori 20x20 -->
    <div class="puzzle">
      <h2>Norinori 20×20</h2>
      <button onclick="generateNorinori()">🔄 Generar Nuevo</button>
      <div class="message" id="msg-norinori"></div>
      <div id="norinori"></div>
    </div>

    <!-- Sudoku -->
    <div class="puzzle">
      <h2>Sudoku (Nivel Normal)</h2>
      <button onclick="generateSudoku()">🔄 Generar Nuevo</button>
      <div class="message" id="msg-sudoku"></div>
      <div id="sudoku"></div>
    </div>
  </div>

  <script>
    // Estado global para soluciones
    const State = {
      nonogram5: { solution: null, size: 5 },
      nonogram10: { solution: null, size: 10 },
      norinori: { solution: null, dominoMap: null },
      sudoku: { solution: null, puzzle: null }
    };

    // --------------------------
    // NONOGRAM GENERATOR
    // --------------------------
    function generateNonogram(size) {
      const id = `nonogram${size}`;
      const msgId = `msg-${id}`;
      document.getElementById(msgId).textContent = "";
      const container = document.getElementById(id);
      container.innerHTML = "";

      const solution = Array(size).fill().map(() => Array(size).fill(0));
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          solution[i][j] = Math.random() < 0.4 ? 1 : 0;
        }
      }
      State[id] = { solution, size };

      // Pistas
      const rowClues = solution.map(row => {
        const clues = [];
        let count = 0;
        for (let cell of row) {
          if (cell === 1) count++;
          else if (count > 0) {
            clues.push(count);
            count = 0;
          }
        }
        if (count > 0) clues.push(count);
        return clues.length ? clues : [0];
      });

      const colClues = [];
      for (let j = 0; j < size; j++) {
        const clues = [];
        let count = 0;
        for (let i = 0; i < size; i++) {
          if (solution[i][j] === 1) count++;
          else if (count > 0) {
            clues.push(count);
            count = 0;
          }
        }
        if (count > 0) clues.push(count);
        colClues.push(clues.length ? clues : [0]);
      }

      const table = document.createElement("table");

      // Encabezado (pistas de columnas)
      const header = document.createElement("tr");
      header.appendChild(createTh(""));
      colClues.forEach(clue => {
        const th = createTh(clue.join(" "));
        th.classList.add("clue");
        header.appendChild(th);
      });
      table.appendChild(header);

      // Filas
      for (let i = 0; i < size; i++) {
        const tr = document.createElement("tr");
        const clueTd = createTd(rowClues[i].join(" "));
        clueTd.classList.add("clue");
        tr.appendChild(clueTd);

        for (let j = 0; j < size; j++) {
          const td = createTd("");
          td.className = "cell";
          td.dataset.row = i;
          td.dataset.col = j;
          td.onclick = function() {
            if (this.classList.contains("filled")) {
              this.classList.remove("filled");
              this.classList.add("crossed");
            } else if (this.classList.contains("crossed")) {
              this.classList.remove("crossed");
            } else {
              this.classList.add("filled");
            }
            checkNonogram(size);
          };
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }

      container.appendChild(table);
    }

    function createTh(txt) {
      const th = document.createElement("th");
      th.textContent = txt;
      return th;
    }
    function createTd(txt) {
      const td = document.createElement("td");
      td.textContent = txt;
      return td;
    }

    function checkNonogram(size) {
      const id = `nonogram${size}`;
      const solution = State[id].solution;
      const cells = document.querySelectorAll(`#${id} .cell`);
      let solved = true;

      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          const idx = i * size + j;
          const cell = cells[idx];
          const shouldBeFilled = solution[i][j] === 1;
          const isFilled = cell.classList.contains("filled");
          if (shouldBeFilled !== isFilled) {
            solved = false;
            break;
          }
        }
        if (!solved) break;
      }

      const msgId = `msg-${id}`;
      if (solved) {
        document.getElementById(msgId).textContent = "✅ ¡Nonograma resuelto!";
      } else {
        document.getElementById(msgId).textContent = "";
      }
    }

    // --------------------------
    // NORINORI GENERATOR
    // --------------------------
    function generateNorinori() {
      const size = 20;
      const container = document.getElementById("norinori");
      const msg = document.getElementById("msg-norinori");
      container.innerHTML = "";
      msg.textContent = "";

      const solution = Array(size).fill().map(() => Array(size).fill(0));
      const dominoMap = Array(size).fill().map(() => Array(size).fill(null));
      const used = Array(size).fill().map(() => Array(size).fill(false));
      let dominoId = 0;

      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (used[i][j]) continue;
          const orientations = [];
          if (j + 1 < size && !used[i][j+1]) orientations.push("h");
          if (i + 1 < size && !used[i+1][j]) orientations.push("v");
          if (orientations.length === 0) continue;

          const dir = orientations[Math.floor(Math.random() * orientations.length)];
          const id = dominoId++;
          if (dir === "h") {
            used[i][j] = used[i][j+1] = true;
            dominoMap[i][j] = dominoMap[i][j+1] = id;
          } else {
            used[i][j] = used[i+1][j] = true;
            dominoMap[i][j] = dominoMap[i+1][j] = id;
          }
        }
      }

      State.norinori = { solution, dominoMap };

      const table = document.createElement("table");
      table.className = "norinori";

      for (let i = 0; i < size; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j < size; j++) {
          const td = document.createElement("td");
          td.className = "cell";
          td.dataset.row = i;
          td.dataset.col = j;
          td.onclick = function() {
            this.classList.toggle("filled");
            checkNorinori();
          };
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }

      container.appendChild(table);
    }

    function checkNorinori() {
      const { dominoMap } = State.norinori;
      const cells = document.querySelectorAll("#norinori .cell");
      const filledMap = new Map();

      cells.forEach(cell => {
        const r = parseInt(cell.dataset.row);
        const c = parseInt(cell.dataset.col);
        const id = dominoMap[r][c];
        if (id !== null) {
          if (!filledMap.has(id)) filledMap.set(id, 0);
          if (cell.classList.contains("filled")) {
            filledMap.set(id, filledMap.get(id) + 1);
          }
        }
      });

      let solved = true;
      for (let count of filledMap.values()) {
        if (count !== 1) {
          solved = false;
          break;
        }
      }

      const msg = document.getElementById("msg-norinori");
      if (solved && filledMap.size > 0) {
        msg.textContent = "✅ ¡Norinori resuelto! Un cuadrado por dominó.";
      } else {
        msg.textContent = "";
      }
    }

    // --------------------------
    // SUDOKU GENERATOR
    // --------------------------
    function generateSudoku() {
      const container = document.getElementById("sudoku");
      const msg = document.getElementById("msg-sudoku");
      container.innerHTML = "";
      msg.textContent = "";

      let board = Array(9).fill().map(() => Array(9).fill(0));

      function isValid(row, col, num) {
        for (let i = 0; i < 9; i++) {
          if (board[row][i] === num || board[i][col] === num) return false;
        }
        const br = Math.floor(row / 3) * 3;
        const bc = Math.floor(col / 3) * 3;
        for (let i = 0; i < 3; i++) {
          for (let j = 0; j < 3; j++) {
            if (board[br + i][bc + j] === num) return false;
          }
        }
        return true;
      }

      function solve(row = 0, col = 0) {
        if (row === 9) return true;
        if (col === 9) return solve(row + 1, 0);
        if (board[row][col] !== 0) return solve(row, col + 1);

        const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);
        for (let num of nums) {
          if (isValid(row, col, num)) {
            board[row][col] = num;
            if (solve(row, col + 1)) return true;
          }
        }
        board[row][col] = 0;
        return false;
      }

      solve();
      State.sudoku.solution = board.map(row => [...row]);

      // Crear puzzle
      const puzzle = board.map(row => [...row]);
      const cells = [];
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          cells.push([i, j]);
        }
      }
      cells.sort(() => Math.random() - 0.5);
      for (let k = 0; k < 45; k++) {
        const [i, j] = cells[k];
        puzzle[i][j] = 0;
      }
      State.sudoku.puzzle = puzzle;

      const table = document.createElement("table");
      table.className = "sudoku";

      for (let i = 0; i < 9; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j < 9; j++) {
          const td = document.createElement("td");
          const input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          input.dataset.row = i;
          input.dataset.col = j;
          if (puzzle[i][j] !== 0) {
            input.value = puzzle[i][j];
            input.classList.add("fixed");
            input.readOnly = true;
          } else {
            input.addEventListener("input", function () {
              this.value = this.value.replace(/[^1-9]/g, '');
              validateSudoku();
            });
          }
          td.appendChild(input);
          tr.appendChild(td);
        }
        table.appendChild(tr);
      }
      container.appendChild(table);
    }

    function validateSudoku() {
      const inputs = document.querySelectorAll("#sudoku input");
      const grid = Array(9).fill().map(() => Array(9).fill(0));
      let complete = true;

      for (let input of inputs) {
        const r = parseInt(input.dataset.row);
        const c = parseInt(input.dataset.col);
        const val = input.value.trim();
        if (val === "") {
          complete = false;
          grid[r][c] = 0;
        } else {
          grid[r][c] = parseInt(val);
        }
      }

      if (!complete) return;

      const solution = State.sudoku.solution;
      let correct = true;
      for (let i = 0; i < 9; i++) {
        for (let j = 0; j < 9; j++) {
          if (grid[i][j] !== solution[i][j]) {
            correct = false;
            break;
          }
        }
        if (!correct) break;
      }

      const msg = document.getElementById("msg-sudoku");
      if (correct) {
        msg.textContent = "✅ ¡Sudoku resuelto correctamente!";
        msg.style.color = "#27ae60";
      } else {
        msg.textContent = "❌ Algo no coincide. Revisa tus números.";
        msg.style.color = "#e74c3c";
      }
    }

    // Iniciar con un nonograma pequeño
    window.onload = () => generateNonogram(5);
  </script>
</body>
</html>
